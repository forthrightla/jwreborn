---
// src/pages/case-studies.astro
import Layout from "../layouts/Layout.astro";
import SimplifiedCard from "../components/SimplifiedCard.astro";
import { getCollection } from "astro:content";

// Preferred ordering for case studies page (slug order)
const preferredOrder = [
  "indeed-case-study",
  "axs-event-entry-case-study",
  "cerebral-case-study",
  "ribbon-legalzoom-case-study",
  "jumprope-nationals-case-study",
  "makerspace-case-study",
  "oreilly-case-study"
];

// Get all case studies, filter out hidden ones
const allCaseStudies = await getCollection("case-studies");
const visibleCaseStudies = allCaseStudies.filter((study) => !study.data.hidden);

const preferredOrderMap = new Map(preferredOrder.map((slug, index) => [slug, index]));

const caseStudies = visibleCaseStudies.sort((a, b) => {
  const indexA = preferredOrderMap.has(a.slug)
    ? preferredOrderMap.get(a.slug)
    : preferredOrder.length;
  const indexB = preferredOrderMap.has(b.slug)
    ? preferredOrderMap.get(b.slug)
    : preferredOrder.length;

  if (indexA !== indexB) {
    return indexA - indexB;
  }

  // Preserve original featured-first ordering for any remaining ties fallback
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  return 0;
});
---

<Layout
  title="Josh Wright - Case Studies | UX Design & Product Strategy"
  currentNav="case-studies"
  description="Explore case studies showcasing UX design, product strategy, and user research work across mobile apps, enterprise software, and consumer products."
>
  <section id="hero" class="block hero-block outer">
    <div class="inner">
      <div class="block-header">
        <h1 class="block-title">Solving <strong>complex problems</strong> with <strong>meaningful outcomes</strong><span class="accent-period">.</span></h1>
      </div>
    </div>
  </section>

  <main id="content" class="site-content">
    <section class="portfolio-block block outer" id="case-studies">
      <div class="inner">

        <div class="block-content">
          <div class="portfolio-feed">
            {caseStudies.map((study) => (
              <SimplifiedCard
                href={`/work/${study.slug}`}
                title={study.data.title}
                img={study.data.thumbnail}
                client={study.data.client}
                highlight={study.data.highlight}
              />
            ))}
          </div>
        </div>

        <div class="block-content">
          <p style="text-align:center;">
            <a href="mailto:josh@joshux.com" class="button">Get in touch</a>
          </p>
        </div>
      </div>
    </section>
  </main>
</Layout>
