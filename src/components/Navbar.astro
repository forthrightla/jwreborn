---
// Define props for the component
interface Props {
  current?: string;
  useSvgLogo?: boolean;
}

const { current, useSvgLogo = false } = Astro.props;
---

<header id="masthead" class="site-header outer">
  <div class="inner">
    <div class="site-header-inside">
      <div class="site-branding">
        <div class="site-title">
          <a href="/">
            {useSvgLogo ? (
              <span class="logo-svg">
               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 710 168">
                <g fill="none">
                  <path fill="#fff" d="M11.46 159.48c-3.64 0-7.32666667-.373333-11.06-1.12v-14.98q3.64.42 5.32.42 3.64 0 5.32-1.89t1.68-7.35v-72.1H31.9v71.68c0 8.4-1.6566667 14.723333-4.97 18.97s-8.47 6.37-15.47 6.37m20.86-107.1H12.44V34.32h19.88zm45.4 83.86c-7.56 0-14.1633333-1.586667-19.81-4.76-5.6466667-3.1733333-9.9633333-7.63-12.95-13.37s-4.48-12.3433333-4.48-19.81 1.5166667-14.0933333 4.55-19.88 7.3733333-10.29 13.02-13.51q8.47000005-4.83 19.95-4.83c7.56 0 14.1633333 1.5866667 19.81 4.76 5.646667 3.1733333 9.963333 7.63 12.95 13.37s4.48 12.3433333 4.48 19.81-1.516667 14.0933333-4.55 19.88-7.373333 10.29-13.02 13.51q-8.47000005 4.83-19.95 4.83m.14-14.7c5.7866667 0 10.1966667-2.0766667 13.23-6.23s4.55-9.87 4.55-17.15-1.5166667-12.9733333-4.55-17.08-7.4433333-6.16-13.23-6.16-10.1966667 2.0533333-13.23 6.16-4.55 9.8-4.55 17.08 1.5166667 12.9966667 4.55 17.15 7.4433333 6.23 13.23 6.23m76.34 14.56c-11.293333 0-19.786667-2.4033333-25.48-7.21s-8.68-11.0366667-8.96-18.69h18.34c.373333 3.92 1.866667 6.93 4.48 9.03q3.9199995 3.15 11.34 3.15c7.746667 0 11.62-2.6133333 11.62-7.84 0-2.8933333-1.143333-4.9466667-3.43-6.16s-6.09-2.38-11.41-3.5l-3.08-.7c-8.026667-1.8666667-14.373333-4.3633333-19.04-7.49s-7-8.0033333-7-14.63 2.636667-11.9233333 7.91-15.89 12.576667-5.95 21.91-5.95q15.2599995 0 23.1 6.72c5.226667 4.48 8.073333 10.1266667 8.54 16.94H164.7c-.466667-3.08-1.656667-5.4833333-3.57-7.21s-5.016667-2.59-9.31-2.59c-3.546667 0-6.183333.6066667-7.91 1.82s-2.59 2.8933333-2.59 5.04c0 2.3333333.863333 3.9666667 2.59 4.9s4.97 1.9133333 9.73 2.94l3.78.84q8.6800005 2.1 14.49 4.41c3.873333 1.54 7.07 3.85 9.59 6.93s3.78 7.1866667 3.78 12.32c0 7.28-2.683333 12.9033333-8.05 16.87-5.366667 3.966667-13.043333 5.95-23.03 5.95m82.22-75.88q10.5 0 17.01 6.51c4.34 4.34 6.51 10.4766667 6.51 18.41V134h-19.32V91.02c0-5.1333333-1.003333-8.9133333-3.01-11.34s-5.11-3.64-9.31-3.64q-7.4200005 0-11.55 3.99c-2.753333 2.66-4.13 6.5566667-4.13 11.69V134h-19.18V33.9h19.18v38.36h.28c2.146667-3.5466667 5.156667-6.44 9.03-8.68q5.8099995-3.36 14.49-3.36m91.5 73.78h-18.48l-20.72-71.54h19.6l12.32 47.88h.28l13.02-47.88h17.5l13.16 47.88h.28l12.46-47.88h19.04L375.52 134h-18.48l-14.42-49h-.28zm111.9-72.52q3.9199995 0 6.3.42v17.22q-2.8000005-.42-4.62-.42c-5.693333 0-10.476667 1.8433333-14.35 5.53s-5.81 8.7033333-5.81 15.05V134h-19.18V62.46h19.18v12.32h.28c1.866667-4.2 4.34-7.4666667 7.42-9.8s6.673333-3.5 10.78-3.5M471.78 134H452.6V62.46h19.18zm.42-81.62h-19.88V34.32h19.88zm59.96 10.08h19.18v64.12c0 11.573333-3.033333 19.973333-9.1 25.2s-14.7 7.84-25.9 7.84c-10.08 0-17.99-2.193333-23.73-6.58s-9.17-9.893333-10.29-16.52h19.6c1.68 5.88 6.486667 8.82 14.42 8.82 5.6 0 9.636667-1.446667 12.11-4.34s3.71-7.6066667 3.71-14.14v-6.16h-.28c-1.96 2.7066667-4.643333 5.0166667-8.05 6.93s-7.583333 2.87-12.53 2.87c-5.973333 0-11.27-1.4233333-15.89-4.27s-8.213333-6.93-10.78-12.25-3.85-11.5266667-3.85-18.62c0-7 1.283333-13.16 3.85-18.48s6.16-9.4266667 10.78-12.32 9.916667-4.34 15.89-4.34c4.853333 0 8.983333.9566667 12.39 2.87q5.1100005 2.86999995 8.19 6.93h.28zM516.2 115.8q7.56 0 11.55-5.25c2.66-3.5 3.99-8.5633333 3.99-15.19 0-6.5333333-1.33-11.55-3.99-15.05q-3.99-5.25-11.55-5.25c-5.226667 0-9.146667 1.7966667-11.76 5.39s-3.92 8.5633333-3.92 14.91 1.306667 11.34 3.92 14.98q3.9199995 5.46 11.76 5.46m89.92-55.58q10.5 0 17.01 6.51c4.34 4.34 6.51 10.4766667 6.51 18.41V134h-19.32V91.02c0-5.1333333-1.003333-8.9133333-3.01-11.34s-5.11-3.64-9.31-3.64q-7.4200005 0-11.55 3.99c-2.753333 2.66-4.13 6.5566667-4.13 11.69V134h-19.18V33.9h19.18v38.36h.28c2.146667-3.5466667 5.156667-6.44 9.03-8.68q5.8099995-3.36 14.49-3.36m66.26 60.2c1.68 0 3.686667-.1866667 6.02-.56v14c-4.106667.933333-7.98 1.4-11.62 1.4-7.28 0-12.623333-1.7966667-16.03-5.39s-5.11-9.59-5.11-17.99V77.16h-10.08v-14.7h10.08V41.32h19.18v21.14h12.88v14.7h-12.88v34.58c0 3.5466667.583333 5.88 1.75 7s3.103333 1.68 5.81 1.68"/>
                  <path fill="#f93b6b" d="M705.18 134h-19.04v-19.04h19.04z"/>
                </g>
              </svg>
              </span>
            ) : (
              <span class="logo-text">Josh Wright</span>
            )}
          </a>
        </div>
      </div>

      <button id="menu-open" class="menu-toggle" aria-label="Open Menu">
        <span class="icon-menu" aria-hidden="true"></span>
      </button>

      <nav id="main-navigation" class="site-navigation" aria-label="Main Navigation">
        <div class="site-nav-inside">
          <button id="menu-close" class="menu-toggle" aria-label="Close Menu">
            <span class="icon-close" aria-hidden="true"></span>
          </button>
          <ul class="menu">
            <li class="menu-item mobile-home-link">
              <a href="/">Home</a>
            </li>
            <li class={`menu-item ${current === 'case-studies' ? 'current-menu-item' : ''}`}>
              <a href="/case-studies">Case studies</a>
            </li>
            <li class={`menu-item ${current === 'about' ? 'current-menu-item' : ''}`}>
              <a href="/#about">About</a>
            </li>
            <li class={`menu-item ${current === 'testimonials' ? 'current-menu-item' : ''}`}>
              <a href="/#testimonials">Testimonials</a>
            </li>
            <!-- <li class="menu-item">
              <a href="#">Resume</a>
            </li>  -->
            <li class="menu-item">
              <a href="mailto:josh@joshux.com">Contact</a>
            </li>
            <li class="menu-item theme-toggle-item">
              <button id="theme-toggle" class="theme-toggle" aria-label="Switch to dark mode" title="Switch to dark mode">
                <span class="theme-toggle-icon">
                  <svg class="icon icon-moon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                  </svg>
                  <svg class="icon icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <circle cx="12" cy="12" r="4"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                  </svg>
                </span>
                <span class="theme-toggle-text">Light mode / Dark mode</span>
              </button>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>

<style>
  /* Logo styles */
  .logo-svg {
    display: flex;
    align-items: center;
  }

  .logo-svg svg {
    height: 1.37em;
    width: auto;
    color: var(--logo-color, currentColor);
  }

  .logo-text {
    /* Text logo inherits existing site-title styles */
  }

  .theme-toggle { 
    background: transparent; 
    border: 0; 
    cursor: pointer; 
    margin-left: 12px; 
    display: inline-flex; 
    align-items: center; 
    padding: 4px; 
  }

  .theme-toggle-icon {
    position: relative;
    width: 1em;
    height: 1em;
    display: inline-block;
    flex-shrink: 0;
  }
  
  .theme-toggle-icon .icon {
    width: 100%;
    height: 100%;
    color: var(--color-accent-contrast, #fff);
    position: absolute;
    left: 0;
    top: 0;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  
  /* Light mode: show moon (click to go dark) */
  .theme-toggle-icon .icon-moon { 
    opacity: 1;
    visibility: visible;
  }
  .theme-toggle-icon .icon-sun { 
    opacity: 0;
    visibility: hidden;
  }
  
  /* Dark mode: show sun (click to go light) */
  .theme-toggle.is-dark .icon-moon { 
    opacity: 0;
    visibility: hidden;
  }
  .theme-toggle.is-dark .icon-sun { 
    opacity: 1;
    visibility: visible;
  }

  /* As a menu item on desktop */
  .site-navigation .theme-toggle-item { display: inline-block; margin-left: 30px; vertical-align: middle; }
  .site-navigation .theme-toggle { 
    padding: 0; 
    line-height: 1.5;
    font-size: var(--text-xs);
    vertical-align: baseline;
  }

  /* Hide mobile home link and theme toggle text on desktop */
  .mobile-home-link { display: none !important; }
  .theme-toggle-text { display: none; }

  /* As a full-width row on mobile flyout */
  @media only screen and (max-width: 800px) {
    .mobile-home-link { display: block; }

    .site-navigation .theme-toggle-item {
      display: block;
      margin: 0;
      border-bottom: 1px solid var(--color-border);
    }
    .site-navigation .theme-toggle {
      padding: 0.83333rem 0;
      width: 100%;
      text-align: left;
      display: flex;
      align-items: center;
      height: auto;
    }

    .site-navigation .theme-toggle-icon {
      width: 24px;
      height: 24px;
    }
    .theme-toggle-text {
      display: block;
      margin-left: 12px;
      font-size: var(--text-xs);
      color: currentColor;
    }
  }
</style>

<script>
  // Initialize mobile menu
  function initMobileMenu() {
    const menuOpen = document.getElementById('menu-open');
    const menuClose = document.getElementById('menu-close');
    const nav = document.getElementById('main-navigation');
    const siteHeader = document.getElementById('masthead');
    
    // Re-use existing overlay if it exists, otherwise create it
    let overlay = document.querySelector('.site-overlay');
    if (!overlay) {
      overlay = document.createElement('div');
      overlay.className = 'site-overlay';
      document.body.appendChild(overlay);
    }
    
    if (menuOpen) {
      menuOpen.addEventListener('click', function() {
        nav.classList.add('is-open');
        overlay.classList.add('is-visible');
        document.body.style.overflow = 'hidden';
      });
    }
    
    if (menuClose) {
      menuClose.addEventListener('click', function() {
        nav.classList.remove('is-open');
        overlay.classList.remove('is-visible');
        document.body.style.overflow = '';
      });
    }
    
    overlay.addEventListener('click', function() {
      nav.classList.remove('is-open');
      overlay.classList.remove('is-visible');
      document.body.style.overflow = '';
    });
  }

  // Theme toggle logic - run immediately to sync with theme set in <head>
  function initThemeToggle() {
    const btn = document.getElementById('theme-toggle');
    if (!btn) return;
    
    function getTheme() { 
      return document.documentElement.getAttribute('data-theme') || 'light'; 
    }
    
    function setTheme(t) {
      document.documentElement.setAttribute('data-theme', t);
      try { localStorage.setItem('theme', t); } catch (e) {}
    }
    
    function updateA11yLabel() {
      const t = getTheme();
      const next = t === 'dark' ? 'light' : 'dark';
      const label = next === 'dark' ? 'Switch to dark mode' : 'Switch to light mode';
      btn.setAttribute('aria-label', label);
      btn.setAttribute('title', label);
    }

    function syncIcon() {
      const t = getTheme();
      if (t === 'dark') btn.classList.add('is-dark');
      else btn.classList.remove('is-dark');
    }

    function updateToggleText() {
      const textElement = document.querySelector('.theme-toggle-text');
      if (textElement) {
        const t = getTheme();
        textElement.textContent = t === 'dark' ? 'Light mode' : 'Dark mode';
      }
    }
    
    // Sync icon and text immediately to match theme already set by inline script in <head>
    syncIcon();
    updateA11yLabel();
    updateToggleText();

    btn.addEventListener('click', function() {
      const next = getTheme() === 'dark' ? 'light' : 'dark';
      setTheme(next);
      updateA11yLabel();
      syncIcon();
      updateToggleText();
    });
  }
  
  // Handle mobile anchor link clicks to close menu
  function initMobileAnchorLinks() {
    // Find the Home, About and Testimonials anchor links in the mobile menu
    const homeLink = document.querySelector('nav a[href="/"]');
    const aboutLink = document.querySelector('nav a[href="/#about"]');
    const testimonialsLink = document.querySelector('nav a[href="/#testimonials"]');

    // Function to close mobile menu (only works when menu is actually open)
    function closeMobileMenu() {
      const nav = document.getElementById('main-navigation');
      const overlay = document.querySelector('.site-overlay');

      if (nav) nav.classList.remove('is-open');
      if (overlay) overlay.classList.remove('is-visible');
      document.body.style.overflow = '';
    }

    // Add click handlers to close menu when anchor links are clicked
    // These will only have an effect when the menu is actually open (mobile only)
    if (homeLink) {
      homeLink.addEventListener('click', closeMobileMenu);
    }

    if (aboutLink) {
      aboutLink.addEventListener('click', closeMobileMenu);
    }

    if (testimonialsLink) {
      testimonialsLink.addEventListener('click', closeMobileMenu);
    }
  }

  // Run as soon as the script executes (Navbar is already in DOM)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      initMobileMenu();
      initThemeToggle();
      initMobileAnchorLinks();
    });
  } else {
    // DOM already loaded, run immediately
    initMobileMenu();
    initThemeToggle();
    initMobileAnchorLinks();
  }
</script>